---
title: "The Average Goals per Player per Season in the NHL (2000-2018)"
#author: "Fall 2020, JMN420: Jeffrey Yao, Martha Dixon, Nisha Sen"
#date: "Due: Monday, December 14"
output: 
  html_document:
    theme: readable
    toc: yes
---

```{r setup, echo = FALSE, message = FALSE, warning = FALSE}
options(scipen = 1, digits = 4, width = 80)
```


# Introduction

# Methods

First, we need to load the dataset, and we can take a look at the first and last few observations and name all of the variables.
```{r}
skaters_full = read.csv("skater_stats.csv")
head(skaters_full)
tail(skaters_full)
names(skaters_full)
```

This data set in its entirety is quite large, and encompasses a large time frame, from 1940 until 2018. In order to make this more relevant, we decided to subset the data and only consider observations between 2000 and 2018, as follows.

```{r}
skaters <- subset(skaters_full, Season >= 2000)
```

Next, looking at the structure of our data frame, we can see that we have:

- a lot of numerical observations that R views as character observations, and
- a lot of empty values within each category, which become NA values once we convert variables to numeric. 

```{r}
str(skaters)
```


We amend this by converting the relevant vectors to numeric and setting all of the NA values equal to 0. We can see how this changes the dataset by again checking the structure.

```{r, warning = FALSE}
skaters$Pos <- as.factor(skaters$Pos)
skaters$Age <- as.numeric(skaters$Age)
skaters$GP <- as.numeric(skaters$GP)
skaters$G <- as.numeric(skaters$G)
skaters$GPG <- as.numeric(skaters$GPG)
skaters$A <- as.numeric(skaters$A)
skaters$PTS <- as.numeric(skaters$PTS)
skaters$X... <- as.numeric(skaters$X...)
skaters$PIM <- as.numeric(skaters$PIM)
skaters$EVG <- as.numeric(skaters$EVG)
skaters$PPG <- as.numeric(skaters$PPG)
skaters$SHG <- as.numeric(skaters$SHG)
skaters$GWG <- as.numeric(skaters$GWG)
skaters$EVA <- as.numeric(skaters$EVA)
skaters$PPA <- as.numeric(skaters$PPA)
skaters$SHA <- as.numeric(skaters$SHA)
skaters$S <- as.numeric(skaters$S)
skaters$S. <- as.numeric(skaters$S.)
skaters$TOI <- as.numeric(skaters$TOI)
skaters$BLK <- as.numeric(skaters$BLK)
skaters$HIT <- as.numeric(skaters$HIT)
skaters$FOwin <- as.numeric(skaters$FOwin)
skaters$FOloss <- as.numeric(skaters$FOloss)
skaters$FO. <- as.numeric(skaters$FO.)
```

```{r}
skaters[is.na(skaters)] = 0
str(skaters)
```

As we can see, we have a lot of different predictors to choose from when we consider how to best model the average goals per player. The response variable we are considering, Goals (`G`), is used in the calculations of a few other variables, so we exclude these variables from our consideration. These variables include: 

- `PTS`, points tallied by that player in corresponding season; `PTS` = `G` + `A`
- `GPG`, goals per game by that player in corresponding season
- `EVG`, goals scored by player while team is even strength
- `PPG`, goals scored by player while team is on the powerplay
- `SHG`, goals scored by player while team is on the penalty kill
- `GWG`, game winning goals scored by player in that season
- `S.` or S%, the shooting percentage of player, which is calculated from goals scored (G) divided by the shots taken (S)

We also exclude the variable `X` from our analysis, since it is not included as a variable in the source documentation for our data; this column exists as a descriptor and is a combination of `Season` and `Player`.

We take this into account below, and remove these variables:

```{r}
skaters_cleaned <- skaters[, c(4, 6, 7, 8, 10, 13, 21, 25, 26, 27, 28)]

```

The full additive model(excluding the variables above) can be found in the **Appendix** section.

Before we started testing models, we needed to make sure we were able to check and validate assumptions. We used the following functions to do so graphically:

```{r}
plot_fitted_resid = function(model, pointcol = "dodgerblue", linecol = "darkorange") {
  plot(fitted(model), resid(model), 
       col = pointcol, pch = 20, cex = 1.5,
       xlab = "Fitted", ylab = "Residuals")
  abline(h = 0, col = linecol, lwd = 2)
}

plot_qq = function(model, pointcol = "dodgerblue", linecol = "darkorange") {
  qqnorm(resid(model), col = pointcol, pch = 20, cex = 1.5)
  qqline(resid(model), col = linecol, lwd = 2)
}

```



# Results

# Discussion

# Appendix

The full additive model:

```{r}
goals_addfull = lm(G ~ ., data = skaters_cleaned)
summary(goals_addfull)$r.sq
```

Interaction models took too long to run with RStudio (even models that used only 2 predictors), so we excluded those from our analysis as well.



### Fall 2020, JMN420: Jeffrey Yao, Martha Dixon, Nisha Sen